# Migration `20200417153012`

This migration has been generated by devnok at 4/17/2020, 3:30:12 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."Authentication.provider_token"

ALTER TABLE "public"."Authentication" DROP COLUMN "provider",
DROP COLUMN "token",
ADD COLUMN "userId" text  NOT NULL ;

ALTER TABLE "public"."Rest" DROP COLUMN "closeAt",
DROP COLUMN "openAt",
ADD COLUMN "openingHours" text   ;

CREATE UNIQUE INDEX "Authentication.userId" ON "public"."Authentication"("userId")

ALTER TABLE "public"."Authentication" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200417152208..20200417153012
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model AccountLink {
   provider Provider
@@ -72,16 +72,15 @@
   user     User      @relation(fields: [userId], references: [id])
 }
 model Rest {
-  closeAt   DateTime?
+  openingHours String?
   desc      String
   id        Int       @default(autoincrement()) @id
   name      String
-  openAt    DateTime?
   phone     String
   thumbnail String
-  Coupon    Coupon[]
+  coupons    Coupon[]
   File      File[]
   Like      Like[]
   Location  Location
   Service   Service?
@@ -100,22 +99,21 @@
   createdAt   DateTime     @default(now())
   id          String       @id
   nickname    String       @unique
   phone       String       @unique
-  AccountLink AccountLink[]
-  Coupon      Coupon[]
-  Like        Like[]
-  Profile     Profile
+  links AccountLink[]
+  coupons      Coupon[]
+  likes        Like[]
+  profile     Profile
 }
 model Authentication {
   id        Int      @default(autoincrement()) @id
-  provider Provider
-  token String
   code String
   limit Int @default(5)
   createdAt DateTime @default(now())
   expireAt DateTime
-  @@unique([provider, token])
+  userId String @unique
+  user   User   @relation(fields: [userId], references: [id])
 }
 model spatial_ref_sys {
   auth_name String?
```


