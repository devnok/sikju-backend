# Migration `20200410154524`

This migration has been generated by devnok at 4/10/2020, 3:45:24 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Gender" AS ENUM ('MALE', 'FEMALE');

CREATE TABLE "public"."User" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" SERIAL,
    "nickname" text  NOT NULL ,
    "phone" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Profile" (
    "birthday" timestamp(3)   ,
    "email" text   ,
    "gender" "Gender"  DEFAULT 'MALE',
    "id" SERIAL,
    "name" text   ,
    "userId" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."AccountLink" (
    "facebookId" text  NOT NULL ,
    "id" SERIAL,
    "kakaoId" text  NOT NULL ,
    "userId" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Rest" (
    "closeAt" timestamp(3)   ,
    "desc" text  NOT NULL ,
    "id" SERIAL,
    "name" text  NOT NULL ,
    "openAt" timestamp(3)   ,
    "phone" text  NOT NULL ,
    "thumbnail" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."File" (
    "id" SERIAL,
    "restId" integer  NOT NULL ,
    "url" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Service" (
    "desc" text  NOT NULL ,
    "restId" integer  NOT NULL ,
    "service" text  NOT NULL ,
    "validTime" integer  NOT NULL DEFAULT 168,
    "warn" text   
) 

CREATE TABLE "public"."Coupon" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "desc" text  NOT NULL ,
    "expireAt" timestamp(3)  NOT NULL ,
    "id" SERIAL,
    "restId" integer  NOT NULL ,
    "servcie" text  NOT NULL ,
    "startAt" timestamp(3)  NOT NULL ,
    "userId" integer  NOT NULL ,
    "warn" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Location" (
    "latitude" Decimal(65,30)  NOT NULL ,
    "longitude" Decimal(65,30)  NOT NULL ,
    "restId" integer  NOT NULL 
) 

CREATE TABLE "public"."Like" (
    "id" SERIAL,
    "restId" integer  NOT NULL ,
    "userId" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Event" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "expireAt" timestamp(3)  NOT NULL ,
    "id" SERIAL,
    "startAt" timestamp(3)  NOT NULL ,
    "thumbnail" text  NOT NULL ,
    "url" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE UNIQUE INDEX "User.nickname" ON "public"."User"("nickname")

CREATE UNIQUE INDEX "User.phone" ON "public"."User"("phone")

CREATE UNIQUE INDEX "Profile.email" ON "public"."Profile"("email")

CREATE UNIQUE INDEX "Profile_userId" ON "public"."Profile"("userId")

CREATE UNIQUE INDEX "AccountLink.kakaoId" ON "public"."AccountLink"("kakaoId")

CREATE UNIQUE INDEX "AccountLink.facebookId" ON "public"."AccountLink"("facebookId")

CREATE UNIQUE INDEX "AccountLink_userId" ON "public"."AccountLink"("userId")

CREATE UNIQUE INDEX "Service.restId" ON "public"."Service"("restId")

CREATE UNIQUE INDEX "Location.latitude_longitude" ON "public"."Location"("latitude","longitude")

CREATE UNIQUE INDEX "Location_restId" ON "public"."Location"("restId")

CREATE UNIQUE INDEX "Event.url" ON "public"."Event"("url")

ALTER TABLE "public"."Profile" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."AccountLink" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("restId")REFERENCES "public"."Rest"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Service" ADD FOREIGN KEY ("restId")REFERENCES "public"."Rest"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Coupon" ADD FOREIGN KEY ("restId")REFERENCES "public"."Rest"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Coupon" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Location" ADD FOREIGN KEY ("restId")REFERENCES "public"."Rest"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Like" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Like" ADD FOREIGN KEY ("restId")REFERENCES "public"."Rest"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200410154524
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,105 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+enum Gender{
+  MALE
+  FEMALE
+}
+model User{
+  id Int @id @default(autoincrement())
+  nickname String @unique
+  phone String @unique
+  profile Profile
+  link AccountLink?
+  coupons Coupon[]
+  likes Like[]
+  createdAt DateTime @default(now())
+}
+model Profile{
+  id Int @id @default(autoincrement())
+  name String?
+  birthday DateTime?
+  gender Gender? @default(MALE)
+  email String? @unique
+  user User @relation(fields: [userId], references: [id])
+  userId Int
+}
+model AccountLink{
+  id Int @id @default(autoincrement())
+  user User @relation(fields: [userId], references: [id])
+  userId Int
+  kakaoId String @unique
+  facebookId String @unique
+}
+model Rest{
+  id Int @id @default(autoincrement())
+  location Location
+  name String
+  phone String
+  desc String
+  openAt DateTime?
+  closeAt DateTime?
+  coupons Coupon[]
+  files File[] @relation("FilesOnRest")
+  thumbnail String
+  service Service
+  likes Like[]
+}
+model File{
+  id Int @id @default(autoincrement())
+  url String
+  rest Rest @relation("FilesOnRest", fields: [restId], references: [id])
+  restId Int
+}
+model Service{
+  rest Rest @relation(fields: [restId], references: [id])
+  restId Int @unique
+  service String
+  desc String
+  warn String?
+  validTime Int @default(168)
+}
+model Coupon{
+  id Int @id @default(autoincrement())
+  rest Rest @relation(fields: [restId], references: [id])
+  restId Int
+  servcie String
+  desc String
+  warn String
+  user User @relation(fields: [userId], references: [id])
+  userId Int
+  createdAt DateTime @default(now())
+  startAt DateTime
+  expireAt DateTime
+}
+model Location{
+  rest Rest @relation(fields: [restId], references: [id])
+  restId Int
+  longitude Float
+  latitude Float
+  @@unique([latitude, longitude])
+}
+model Like{
+  id Int @id @default(autoincrement())
+  user User @relation(fields: [userId], references: [id])
+  userId Int
+  rest Rest @relation(fields: [restId], references: [id])
+  restId Int
+}
+model Event {
+  id Int @id @default(autoincrement())
+  url String @unique
+  thumbnail String
+  createdAt DateTime @default(now())
+  startAt DateTime
+  expireAt DateTime
+}
```


