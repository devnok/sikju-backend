# Migration `20200410161100-`

This migration has been generated by devnok at 4/10/2020, 4:11:00 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP TABLE "public"."AccountLink","public"."Coupon","public"."Event","public"."File","public"."Like","public"."Location","public"."Profile","public"."Rest","public"."Service","public"."User";

CREATE TYPE "Gender" AS ENUM ('FEMALE', 'MALE');

CREATE TABLE "public"."AccountLink" (
    "facebookId" text  NOT NULL ,
    "id" SERIAL,
    "kakaoId" text  NOT NULL ,
    "userId" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Coupon" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "desc" text  NOT NULL ,
    "expireAt" timestamp(3)  NOT NULL ,
    "id" SERIAL,
    "restId" integer  NOT NULL ,
    "servcie" text  NOT NULL ,
    "startAt" timestamp(3)  NOT NULL ,
    "userId" text  NOT NULL ,
    "warn" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Event" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "expireAt" timestamp(3)  NOT NULL ,
    "id" SERIAL,
    "startAt" timestamp(3)  NOT NULL ,
    "thumbnail" text  NOT NULL ,
    "url" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."File" (
    "id" SERIAL,
    "restId" integer  NOT NULL ,
    "url" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Like" (
    "id" SERIAL,
    "restId" integer  NOT NULL ,
    "userId" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Location" (
    "latitude" Decimal(65,30)  NOT NULL ,
    "longitude" Decimal(65,30)  NOT NULL ,
    "restId" integer  NOT NULL 
) 

CREATE TABLE "public"."Profile" (
    "birthday" timestamp(3)   ,
    "email" text   ,
    "gender" "Gender"  ,
    "id" SERIAL,
    "name" text   ,
    "userId" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Rest" (
    "closeAt" timestamp(3)   ,
    "desc" text  NOT NULL ,
    "id" SERIAL,
    "name" text  NOT NULL ,
    "openAt" timestamp(3)   ,
    "phone" text  NOT NULL ,
    "thumbnail" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Service" (
    "desc" text  NOT NULL ,
    "restId" integer  NOT NULL ,
    "service" text  NOT NULL ,
    "validTime" integer  NOT NULL DEFAULT 168,
    "warn" text   
) 

CREATE TABLE "public"."User" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "id" text  NOT NULL ,
    "nickname" text  NOT NULL ,
    "phone" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE UNIQUE INDEX "AccountLink.facebookId" ON "public"."AccountLink"("facebookId")

CREATE UNIQUE INDEX "AccountLink.kakaoId" ON "public"."AccountLink"("kakaoId")

CREATE UNIQUE INDEX "AccountLink.userId" ON "public"."AccountLink"("userId")

CREATE UNIQUE INDEX "Event.url" ON "public"."Event"("url")

CREATE UNIQUE INDEX "Location.restId" ON "public"."Location"("restId")

CREATE UNIQUE INDEX "Location.latitude_longitude" ON "public"."Location"("latitude","longitude")

CREATE UNIQUE INDEX "Profile.email" ON "public"."Profile"("email")

CREATE UNIQUE INDEX "Profile.userId" ON "public"."Profile"("userId")

CREATE UNIQUE INDEX "Service.restId" ON "public"."Service"("restId")

CREATE UNIQUE INDEX "User.nickname" ON "public"."User"("nickname")

CREATE UNIQUE INDEX "User.phone" ON "public"."User"("phone")

ALTER TABLE "public"."AccountLink" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Coupon" ADD FOREIGN KEY ("restId")REFERENCES "public"."Rest"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Coupon" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."File" ADD FOREIGN KEY ("restId")REFERENCES "public"."Rest"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Like" ADD FOREIGN KEY ("restId")REFERENCES "public"."Rest"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Like" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Location" ADD FOREIGN KEY ("restId")REFERENCES "public"."Rest"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Profile" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Service" ADD FOREIGN KEY ("restId")REFERENCES "public"."Rest"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200410155017..20200410161100-
--- datamodel.dml
+++ datamodel.dml
@@ -3,16 +3,16 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 model AccountLink {
   facebookId String @unique
   id         Int    @default(autoincrement()) @id
   kakaoId    String @unique
-  userId     Int    @unique
+  userId String    @unique
   User       User   @relation(fields: [userId], references: [id])
 }
 model Coupon {
@@ -22,9 +22,9 @@
   id        Int      @default(autoincrement()) @id
   restId    Int
   servcie   String
   startAt   DateTime
-  userId    Int
+  userId String
   warn      String
   Rest      Rest     @relation(fields: [restId], references: [id])
   User      User     @relation(fields: [userId], references: [id])
 }
@@ -47,9 +47,9 @@
 model Like {
   id     Int  @default(autoincrement()) @id
   restId Int
-  userId Int
+  userId String
   Rest   Rest @relation(fields: [restId], references: [id])
   User   User @relation(fields: [userId], references: [id])
 }
@@ -67,9 +67,9 @@
   email    String?   @unique
   gender   Gender?   @default(dbgenerated())
   id       Int       @default(autoincrement()) @id
   name     String?
-  userId   Int       @unique
+  userId String       @unique
   User     User      @relation(fields: [userId], references: [id])
 }
 model Rest {
@@ -97,9 +97,9 @@
 }
 model User {
   createdAt   DateTime     @default(now())
-  id          Int          @default(autoincrement()) @id
+  id          String          @default(cuid()) @id
   nickname    String       @unique
   phone       String       @unique
   AccountLink AccountLink?
   Coupon      Coupon[]
```


